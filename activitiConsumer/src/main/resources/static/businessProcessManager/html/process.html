<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>流程管理</title>
    <link rel="stylesheet" href="/businessProcessManager/js/ele/index.css">
    <link rel="stylesheet" href="/businessProcessManager/css/style.css">
</head>
<body>
<header>
    <img src="/businessProcessManager/images/logo.png" alt="">
    <span class="com-name">业务流程管理平台</span>
</header>
<div>
    <div class="side" id="side">
        <div id="menu" class="menu">
            <el-menu default-active="2" unique-opened class="el-menu-vertical-demo" @open="handleOpen" @close="handleClose">
                <el-submenu index="1">
                    <template slot="title"><i class="el-icon-menu"></i>业务流程管理</template>
                    <a href="
                    .html"><el-menu-item index="1-1">流程管理</el-menu-item></a>
                    <a href="/sortManager"><el-menu-item index="1-2">分类管理</el-menu-item></a>
                    <a href="monitor.html"><el-menu-item index="1-3">运行监控</el-menu-item></a>
                    <a href="task-entrust.html"><el-menu-item index="1-4">任务委托</el-menu-item></a>
                    <a href="user-group.html"><el-menu-item index="1-5">用户分组</el-menu-item></a>
                    <a href="dataAllocation.html"><el-menu-item index="1-6">数据配置</el-menu-item></a>
                    <a href="exampleAllocation.html"><el-menu-item index="1-7">实例配置</el-menu-item></a>
                </el-submenu>
            </el-menu>

        </div>
    </div>
    <div class="main-wrapper">
        <div class="nav-bar">
            <span class="position-info">您现在的位置：<a>公文管理</a> &gt; <span class="current-position">公文会签</span></span>
        </div>
        <div class="tool" id="tool">
            <el-button type="primary" @click="add">新增</el-button>
            <el-button @click="del" size="">删除</el-button>
        </div>
        <div class="content-wrapper relative">
            <div id="tree" class="tree-wrapper">
                    <el-tree

                            :data="treeDatas"
                            node-key="id"
                            ref="tree"
                            highlight-current
                            lazy
                            :expand-on-click-node="false"
                            :load="loadNode"
                            @node-click="getKey"
                            :props="defaultProps">
                    </el-tree>
            </div>
            <div class="tabs-lay" id="tabs" style="margin-left: 200px">
                <div class="from-box">
                    <template class="">
                        <el-tabs v-model="activeName" @tab-click="handleClick">
                            <el-tab-pane label="基本信息" name="first">
                                <el-form :model="form1" :inline="true" class="demo-form-inline">
                                    <el-form-item   label="流程编号：" :label-width="formLabelWidth">
                                        <el-input v-model="form1.processCode"  auto-complete="off"></el-input>
                                    </el-form-item>
                                    <el-form-item   label="流程名称：" :label-width="formLabelWidth">
                                        <el-input v-model="form1.processName" auto-complete="off"></el-input>
                                    </el-form-item>
                                    <el-form-item   label="流程图ID：" :label-width="formLabelWidth">
                                        <el-input v-model="form1.deploymentId"  auto-complete="off"></el-input>
                                    </el-form-item>
                                    <el-form-item  class="long-text" label="流程描述：" :label-width="formLabelWidth">
                                        <el-input type="textarea" :autosize="{ minRows: 1, maxRows: 1}" v-model="form1.describtion"  auto-complete="off"></el-input>
                                    </el-form-item>
                                     <el-form-item  class="long-text"  label="流程分类：" :label-width="formLabelWidth">
                                         <el-input type="textarea"  :autosize="{ minRows: 1, maxRows: 1}"  v-model="form1.flowClassify"  auto-complete="off"></el-input>
                                    </el-form-item>
                                    <el-form-item   label="上级编码：" :label-width="formLabelWidth">
                                        <el-input v-model="form1.parentCode"  auto-complete="off"></el-input>
                                    </el-form-item>
                                    <div class="btn-box">
                                        <el-form-item  :label-width="formLabelWidth">
                                            <el-button type="primary" @click="save1"> 保 存 </el-button>
                                            <el-button type="" > 取 消 </el-button>
                                        </el-form-item>
                                    </div>
                                </el-form>
                            </el-tab-pane>
                            <el-tab-pane label="流程建模" name="second">
                                <el-form :model="form2" :inline="true" :model="formInline" class="demo-form-inline">
                                    <el-form-item   label="流程编号：" :label-width="formLabelWidth">
                                        <el-input v-model="form2.code"  auto-complete="off"></el-input>
                                    </el-form-item>
                                    <el-form-item   label="流程名称：" :label-width="formLabelWidth">
                                        <el-input v-model="form2.name" auto-complete="off"></el-input>
                                    </el-form-item>
                                    <el-form-item   label="流程图ID：" :label-width="formLabelWidth">
                                        <el-input v-model="form2.id"  auto-complete="off"></el-input>
                                    </el-form-item>
                                    <el-form-item class="long-text"  label="流程描述：" :label-width="formLabelWidth">
                                        <el-input type="textarea" autosize v-model="form2.describe"  auto-complete="off"></el-input>
                                    </el-form-item>
                                    <el-form-item   class="long-text" label="流程分类：" :label-width="formLabelWidth">
                                        <el-input type="textarea" autosize v-model="form2.classify"  auto-complete="off"></el-input>
                                    </el-form-item>
                                    <el-form-item   label="上级编码：" :label-width="formLabe2Width">
                						<el-input v-model="form2.parentCode"  auto-complete="off"></el-input>
            						</el-form-item>
                                    <div class="btn-box">
                                        <el-form-item  :label-width="formLabelWidth">
                                            <el-button type="primary" @click="save1"> 保 存 </el-button>
                                            <el-button type="" > 取 消 </el-button>
                                        </el-form-item>
                                    </div>
                                </el-form>
                            </el-tab-pane>
                        </el-tabs>
                    </template>
                </div>
                <div class="expand">
                    <el-button type="" icon="plus">扩展内容</el-button>
                </div>
                <div class="expand">
                    <el-button type="" icon="plus">扩展内容</el-button>
                </div>
            </div>

        </div>
        <div class="foot-biu">
             四川新迎顺信息技术股份有限公司
        </div>
    </div>
</div>
<div id="dialog">
	<!--新增弹框-->
    <el-dialog title="新增" :visible.sync="addFormVisible">
        <el-form :model="addForm" :inline="true" class="demo-form-inline">
            <el-form-item   label="流程编号：" :label-width="formLabe2Width">
                <el-input v-model="addForm.processCode"  auto-complete="off"></el-input>
            </el-form-item>
            <el-form-item   label="流程名称：" :label-width="formLabe2Width">
                <el-input v-model="addForm.processName" auto-complete="off"></el-input>
            </el-form-item>
            <el-form-item   label="流程图ID：" :label-width="formLabe2Width">
                <el-input v-model="addForm.deploymentId"  auto-complete="off"></el-input>
            </el-form-item>
            <el-form-item   label="流程描述：" :label-width="formLabelWidth">
                <el-input type="textarea" autosize v-model="addForm.describtion"  auto-complete="off"></el-input>
            </el-form-item>
            <el-form-item  class="long-text"  label="流程分类：" :label-width="formLabelWidth">
                <el-input type="textarea" autosize v-model="addForm.flowClassify"  auto-complete="off"></el-input>
            </el-form-item>
            <el-form-item   label="上级编码：" :label-width="formLabe2Width">
                <el-input v-model="addForm.parentCode"  auto-complete="off"></el-input>
            </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button @click="addFormVisible = false">取 消</el-button>
            <el-button type="primary" @click="addSubmitForm">确 定</el-button>
        </div>
    </el-dialog>
</div>
<!-- 先引入 Vue -->
<script src="/businessProcessManager/js/ele/vue.js"></script>
<script src="/businessProcessManager/js/ele/vue-resource.js"></script>
<script src="/businessProcessManager/js/ele/vue-router.js"></script>
<!-- 引入组件库 -->
<script src="/businessProcessManager/js/ele/index.js"></script>
<script src="/businessProcessManager/js/jquery.min.js"></script>
<script src="/businessProcessManager/js/jquery.mCustomScrollbar.concat.min.js"></script>

<script>
//
    var menu = new Vue({
        el:'#menu',
        methods: {
            handleOpen:function(key, keyPath) {
                console.log(key, keyPath);
            },
            handleClose:function(key, keyPath) {
                console.log(key, keyPath);
            }
        }
    })
    //    弹出框
    var dialog = new Vue({
        el: '#dialog',
        data:{
            formLabelWidth: '180px',
            addFormVisible: false,
            addForm: {
            	processCode: "",
            	processName: "",
            	deploymentId: "",
            	flowClassify: "",
            	describtion: "",
            	parentCode: ""
            },
            formLabe2Width: '180px'
        },
        methods: {
//          提交新增
            addSubmitForm:function () {
                var that =this
                this.$confirm('确认提交吗？', '提示', {
                    type: 'warning'
                }).then(function () {
                    console.log(dialog.addForm);
                    that.$http.post("http://192.168.10.38:9907/actProcess",dialog.addForm).then(function(data){
                		this.$message({
                            message: data.data,
                            type: 'warning'
                        });
                		window.location.reload();
                    },function(response){
                        console.info(response);
                        if(response){

                        }
                    });
                    dialog.addFormVisible = false;
                })
            },

        }
    });
    var tool = new Vue({
        el:'#tool',
        data:{
          delData:''
        },
        methods:{
            add:function () {
                dialog.addFormVisible = true;
            },
            del:function () {
                var that =this;
                var delData=this.delData;
                if(this.delData!=''&&this.delData!=undefined){
                    this.$confirm('确认删除编号为'+this.delData+'的流程吗？', '提示', {
                        type: 'warning'
                    }).then(function () {
                        //删除 do something
                        that.$http.delete("http://192.168.10.38:9907/actProcess/"+delData).then(function(data){
                    		this.$message({
                                message: data.data,
                                type: 'warning'
                            });
                    	window.location.reload();
                        },function(response){
                            console.info(response);
                            if(response){

                            }
                        });
                    }).catch(function () {
                        //取消
                    })
                }else {
                    this.$message({
                        message: '请选择需要删除的流程！',
                        type: 'warning'
                    });
                }
            }
        }
    })
    //    树形
    var tree = new Vue({
        el: '#tree',
        data: {
        	treeDatas:[],
            defaultProps: {
                label: 'NAME'
            }

        },
        methods: {
            getCheckedNodes:function() {
                console.log(this.$refs.tree.getCheckedNodes());
            },
            getCheckedKeys:function() {
                console.log(this.$refs.tree.getCheckedKeys());
            },
            setCheckedNodes:function() {
                this.$refs.tree.setCheckedNodes([{
                    id: 5,
                    label: '二级 2-1'
                }, {
                    id: 9,
                    label: '三级 1-1-1'
                }]);
            },
            getKey:function (data,node) {
            	   this.$http.get("http://192.168.10.38:9907/actProcess/"+data.ID).then(function(data){
            		   tabs.form1 = data.data;
            		   tool.delData = data.data.processCode;
                },function(response){
                    console.info(response);
                    if(response){

                    }
                })
                console.log(data);
            },
            setCheckedKeys:function() {
                this.$refs.tree.setCheckedKeys([3]);
            },
            resetChecked:function() {
                this.$refs.tree.setCheckedKeys([]);
            },
            loadNode:function(node,addNode){
            	var pid;
            	if(node.id==0){
            		pid = "-1";
            	}else{
            		pid = node.data.ID;
            	}
                this.$http.get("http://192.168.10.38:9907/actProcess",{'pid':pid}).then(function(data){
                	addNode(data.data);
                },function(response){
                    console.info(response);
                    if(response){

                    }
                })
            }

//        ,renderContent:function(h, node, data, store) {
//            return ('<span><span><span>{node.label}</span></span>'+
//            '<span style="float: right; margin-right: 20px">'+
//                '<el-button size="mini" on-click={ () => this.append(store, data) }>Append</el-button>'+
//            '<el-button size="mini" on-click={ () => this.remove(store, data) }>Delete</el-button>'+
//            '</span>'+
//            '</span>');
//        }
        }
    });
    var tabs = new Vue({
        el:'#tabs',
        data:{
            activeName: 'first',
            formLabelWidth:'180px',
            form1: {
            	id: "",
            	processCode: "",
            	processName: "",
            	deploymentId: "",
                describtion: "",
                flowClassify: "",
                parentCode: ""
            },
            form2: {
                code: "2312",
                name: "",
                id: "",
                describe: "",
                classify: "",
                parentCode: ""
            },
        },
        methods:{
            handleClick:function(tab, event) {
                console.log(tab, event);
            },
            save1:function () {
            	this.$http.put("http://192.168.10.38:9907/actProcess",tabs.form1).then(function(data){
            		this.$message({
                        message: data.data,
                        type: 'warning'
                    });
            		window.location.reload();
                },function(response){
                    console.info(response);
                    if(response){

                    }
                });
            }
        }
    })
</script>
</body>
</html>
