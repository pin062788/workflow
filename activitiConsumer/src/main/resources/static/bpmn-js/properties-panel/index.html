<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>流程设计器</title>
	<link rel="stylesheet" href="css/diagram-js.css" />
	<link rel="stylesheet" href="vendor/bpmn-font/css/bpmn-embedded.css" />
	<link rel="stylesheet" href="css/app.css" />
	<!--树形选择下拉框-->
	<link href="css/select2.min.css" rel="stylesheet" />
	<link href="css/select2-bootstrap.min.css" rel="stylesheet" />
	<script src="js/jquery.min.js"></script>
	<script src="js/select2.min.js"></script>
	<script src="js/zh-CN.js"></script>
</head>
<body>
	<div class="content" id="js-drop-zone">

		<!--<div class="message intro">
			<div class="note">
        		<a id="js-create-diagram" href>create a new diagram</a> to get started.
      		</div>
		</div>-->

		<div class="message error">
			<div class="note">
				<p>Ooops, we could not display the BPMN 2.0 diagram.</p>

				<div class="details">
					<span>cause of the problem</span>
					<pre></pre>
				</div>
			</div>
		</div>

		<div class="canvas" id="js-canvas">
		</div>
		<div id="js-properties-panel">
			<div class="bpp-properties-header">
				<span class="label">流程类型</span>
				<select id="select" style="width: 100%;margin-left: 10%;border-bottom: 15px" multiple>
					<option value="-1">全部</option>
				</select>
			</div>
		</div>
	</div>

	<ul class="buttons">
		<li>下载</li>
		<li><a id="js-download-diagram" href
			title="download BPMN diagram"> BPMN图标 </a></li>
		<li><a id="js-download-svg" href title="download as SVG image">
				SVG图片 </a></li>
		<li><button>保存</button>
	</ul>

	<script src="index.js" charset="utf-8"></script>
	<!--select树形选择框js-->
	<script type="text/javascript">
		/*动态生成select选择框的option*/
        $(document).ready(function(){
            $.get("http://192.168.10.38:9907/actFlowclassifys",function(data,status){
                for(var i=0;i<data.length;i++){
					var ss ="<option value="+"'"+data[i].classifyCode+"'"+" parent="+"'"+data[i].parentCode+"'"+">"+data[i].classifyName+"</option>";
                    $("#select").append(ss);
				}
            });
        });
		/*select2*/
        $(function() {
            (function($) {
                $.fn.select2tree = function(options) {
                    var defaults = {
                        language: "zh-CN",
                        theme: "bootstrap"
                    };
                    var opts = $.extend(defaults, options);
                    opts.templateResult = function(data, container) {
                        if(data.element) {
                            //insert span element and add 'parent' property
                            var $wrapper = $("<span></span><span>" + data.text + "</span>");
                            var $element = $(data.element);
                            $(container).attr("val", $element.val())
                            if($element.attr("parent")) {
                                $(container).attr("parent", $element.attr("parent"));
                            }
                            return $wrapper;
                        } else {
                            return data.text;
                        }
                    };

                    $(this).select2(opts).on("select2:open", open);
                };

                function moveOption(id) {
                    if(id) {
                        $(".select2-results__options li[parent=" + id + "]").insertAfter(".select2-results__options li[val=" + id + "]");
                        $(".select2-results__options li[parent=" + id + "]").each(function() {
                            moveOption($(this).attr("val"));
                        });
                    } else {
                        $(".select2-results__options li:not([parent])").appendTo(".select2-results__options ul");
                        $(".select2-results__options li:not([parent])").each(function() {
                            moveOption($(this).attr("val"));
                        });
                    }
                }

                //deal switch action
                function switchAction(id, open) {
                    $(".select2-results__options li[parent='" + id + "']").each(function() {
                        switchAction($(this).attr("val"), open);
                    });
                    if(open) {
                        $(".select2-results__options li[val=" + id + "] span[class]:eq(0)").removeClass("glyphicon-chevron-right").addClass("glyphicon-chevron-down");
                        $(".select2-results__options li[parent='" + id + "']").slideDown();
                    } else {
                        $(".select2-results__options li[val=" + id + "] span[class]:eq(0)").addClass("glyphicon-chevron-right").removeClass("glyphicon-chevron-down");
                        $(".select2-results__options li[parent='" + id + "']").slideUp();
                    }
                }

                //get the level of li
                function getLevel(id) {
                    var level = 0;
                    while($(".select2-results__options li[parent][val='" + id + "']").length > 0) {
                        id = $(".select2-results__options li[val='" + id + "']").attr("parent");
                        level++;
                    }
                    return level;
                }

                function open() {
                    setTimeout(function() {
                        moveOption();

                        $(".select2-results__options li").each(function() {
                            var $this = $(this);
                            //loop li add some classes and properties
                            if($this.attr("parent")) {
                                $(this).siblings("li[val=" + $this.attr("parent") + "]").find("span:eq(0)").addClass("glyphicon glyphicon-chevron-down switch").css({
                                    "padding": "0 10px",
                                    "cursor": "default"
                                });
                                $(this).siblings("li[val=" + $this.attr("parent") + "]").find("span:eq(1)").css("font-weight", "bold");
                            }
                            //add gap for children
                            if(!$this.attr("style")) {
                                var paddingLeft = getLevel($this.attr("val")) * 2;
                                $("li[parent='" + $this.attr("parent") + "']").css("padding-left", paddingLeft + "em");
                            }
                        });

                        //override mousedown for collapse/expand
                        $(".switch").mousedown(function() {
                            switchAction($(this).parent().attr("val"), $(this).hasClass("glyphicon-chevron-right"));
                            event.stopPropagation();
                        });

                        //override mouseup to nothing
                        $(".switch").mouseup(function() {
                            return false;
                        });
                    }, 0);
                }
            })(jQuery);

            $("#select").select2tree();
        });
	</script>
</body>
</html>
